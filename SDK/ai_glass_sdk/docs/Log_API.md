# æ—¥å¿—ç³»ç»ŸAPI - ä½¿ç”¨æŒ‡å—

> **ç‰ˆæœ¬**: v1.0 | **æ—¥æœŸ**: 2025-10-27 | **çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

---

## ğŸ“– ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [APIå‚è€ƒ](#äºŒapiå‚è€ƒ)
- [ä½¿ç”¨ç¤ºä¾‹](#ä¸‰ä½¿ç”¨ç¤ºä¾‹)
- [é›†æˆæ–¹æ³•](#å››é›†æˆæ–¹æ³•)
- [è¾“å‡ºæ ¼å¼](#äº”è¾“å‡ºæ ¼å¼)
- [æ³¨æ„äº‹é¡¹](#å…­æ³¨æ„äº‹é¡¹)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŠŸèƒ½ç®€ä»‹

ç»Ÿä¸€çš„æ—¥å¿—è¾“å‡ºç³»ç»Ÿï¼Œä¸ºæ‰€æœ‰æ—¥å¿—è‡ªåŠ¨æ·»åŠ **æ¯«ç§’çº§ç²¾ç¡®æ—¶é—´æˆ³**ã€‚æ”¯æŒä¿¡æ¯ã€é”™è¯¯ã€è°ƒè¯•ã€è­¦å‘Šå››ç§æ—¥å¿—çº§åˆ«ã€‚

### ä¸»è¦ç‰¹æ€§

- âœ… **æ¯«ç§’çº§æ—¶é—´æˆ³** - ç²¾ç¡®åˆ°æ¯«ç§’çš„æ—¶é—´è®°å½•ï¼ˆæ ¼å¼ï¼š`YYYY-MM-DD HH:MM:SS.mmm`ï¼‰
- âœ… **å¤šæ—¥å¿—çº§åˆ«** - æ”¯æŒ infoã€errorã€debugã€warn å››ç§çº§åˆ«
- âœ… **ä½¿ç”¨ç®€å•** - API ä¸ printf å®Œå…¨ä¸€è‡´ï¼Œæ— å­¦ä¹ æˆæœ¬
- âœ… **æ— ç¼–ç é—®é¢˜** - ç›´æ¥ä½¿ç”¨ vprintfï¼Œæ”¯æŒä¸­æ–‡ã€emoji ç­‰æ‰€æœ‰å­—ç¬¦
- âœ… **é›¶ä¾èµ–** - ä»…ä¾èµ–æ ‡å‡†Cåº“ï¼Œæ— å¤–éƒ¨ä¾èµ–
- âœ… **çº¿ç¨‹å®‰å…¨** - åŸºäºæ ‡å‡†è¾“å‡ºï¼Œçº¿ç¨‹å®‰å…¨

### æœ€å°ç¤ºä¾‹

```c
#include "ai_log.h"

int main() {
    log_info("âœ… ç¨‹åºå¯åŠ¨æˆåŠŸ\n");
    log_error("âŒ è¿æ¥å¤±è´¥: %s\n", "Connection refused");
    log_debug("ğŸ“¡ æ”¶åˆ°æ•°æ®: %d å­—èŠ‚\n", 1024);
    log_warn("âš ï¸  å†…å­˜ä½¿ç”¨ç‡: %d%%\n", 85);
    return 0;
}
```

**è¾“å‡ºæ•ˆæœ**ï¼š
```
[2025-10-27 14:23:45.123] âœ… ç¨‹åºå¯åŠ¨æˆåŠŸ
[2025-10-27 14:23:45.456] âŒ è¿æ¥å¤±è´¥: Connection refused
[2025-10-27 14:23:45.789] ğŸ“¡ æ”¶åˆ°æ•°æ®: 1024 å­—èŠ‚
[2025-10-27 14:23:46.012] âš ï¸  å†…å­˜ä½¿ç”¨ç‡: 85%
```

---

## äºŒã€APIå‚è€ƒ

### 2.1 å¤´æ–‡ä»¶

```c
#include "ai_log.h"
```

**å¤´æ–‡ä»¶è·¯å¾„**: `ai_glass_sdk/include/ai_log.h`

### 2.2 æ—¥å¿—å‡½æ•°

#### `log_info()` - ä¿¡æ¯æ—¥å¿—

```c
void log_info(const char *fmt, ...);
```

**åŠŸèƒ½**: è¾“å‡ºä¿¡æ¯çº§åˆ«çš„æ—¥å¿—

**å‚æ•°**:
- `fmt` - æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼ˆä¸ printf æ ¼å¼å®Œå…¨ç›¸åŒï¼‰
- `...` - å¯å˜å‚æ•°åˆ—è¡¨

**ç¤ºä¾‹**:
```c
log_info("âœ… éŸ³é¢‘æ’­æ”¾æˆåŠŸ\n");
log_info("è¿æ¥åˆ°æœåŠ¡å™¨: %s:%d\n", "192.168.1.100", 8080);
log_info("å¤„ç†å®Œæˆï¼Œå…± %d ä¸ªæ–‡ä»¶\n", file_count);
```

---

#### `log_error()` - é”™è¯¯æ—¥å¿—

```c
void log_error(const char *fmt, ...);
```

**åŠŸèƒ½**: è¾“å‡ºé”™è¯¯çº§åˆ«çš„æ—¥å¿—

**å‚æ•°**:
- `fmt` - æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼ˆä¸ printf æ ¼å¼å®Œå…¨ç›¸åŒï¼‰
- `...` - å¯å˜å‚æ•°åˆ—è¡¨

**ç¤ºä¾‹**:
```c
log_error("âŒ æ–‡ä»¶æ‰“å¼€å¤±è´¥: %s\n", strerror(errno));
log_error("å†…å­˜åˆ†é…å¤±è´¥ï¼Œéœ€è¦ %zu å­—èŠ‚\n", required_size);
log_error("Socketè¿æ¥è¶…æ—¶\n");
```

---

#### `log_debug()` - è°ƒè¯•æ—¥å¿—

```c
void log_debug(const char *fmt, ...);
```

**åŠŸèƒ½**: è¾“å‡ºè°ƒè¯•çº§åˆ«çš„æ—¥å¿—

**å‚æ•°**:
- `fmt` - æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼ˆä¸ printf æ ¼å¼å®Œå…¨ç›¸åŒï¼‰
- `...` - å¯å˜å‚æ•°åˆ—è¡¨

**ç¤ºä¾‹**:
```c
log_debug("ğŸ“¡ æ”¶åˆ°æ¶ˆæ¯: ç±»å‹=%d, é•¿åº¦=%d\n", msg_type, msg_len);
log_debug("å†…éƒ¨çŠ¶æ€: state=%d, retry=%d\n", current_state, retry_count);
log_debug("æ€§èƒ½ç»Ÿè®¡: è€—æ—¶ %ld ms\n", elapsed_time);
```

---

#### `log_warn()` - è­¦å‘Šæ—¥å¿—

```c
void log_warn(const char *fmt, ...);
```

**åŠŸèƒ½**: è¾“å‡ºè­¦å‘Šçº§åˆ«çš„æ—¥å¿—

**å‚æ•°**:
- `fmt` - æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼ˆä¸ printf æ ¼å¼å®Œå…¨ç›¸åŒï¼‰
- `...` - å¯å˜å‚æ•°åˆ—è¡¨

**ç¤ºä¾‹**:
```c
log_warn("âš ï¸  ç¼“å†²åŒºä½¿ç”¨ç‡è¿‡é«˜: %d%%\n", usage_percent);
log_warn("æ£€æµ‹åˆ°ç½‘ç»œå»¶è¿Ÿ: %d ms\n", latency);
log_warn("é…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤é…ç½®\n");
```

---

## ä¸‰ã€ä½¿ç”¨ç¤ºä¾‹

### 3.1 æ›¿æ¢ç°æœ‰ printf

**æ›¿æ¢å‰**:
```c
printf("âœ… [AUDIO_PLAYER] éŸ³é¢‘æ’­æ”¾å™¨åˆ›å»ºæˆåŠŸ\n");
printf("âŒ [TTS_CACHE] åˆ›å»ºSocketå¤±è´¥: %s\n", strerror(errno));
printf("ğŸ“¡ [DEBUG-SELECT] å¼€å§‹ç­‰å¾…socketæ•°æ®...\n");
```

**æ›¿æ¢å**:
```c
log_info("âœ… [AUDIO_PLAYER] éŸ³é¢‘æ’­æ”¾å™¨åˆ›å»ºæˆåŠŸ\n");
log_error("âŒ [TTS_CACHE] åˆ›å»ºSocketå¤±è´¥: %s\n", strerror(errno));
log_debug("ğŸ“¡ [DEBUG-SELECT] å¼€å§‹ç­‰å¾…socketæ•°æ®...\n");
```

### 3.2 å®Œæ•´çš„å®¢æˆ·ç«¯ç¨‹åºç¤ºä¾‹

```c
#include "ai_log.h"
#include "ai_audio.h"
#include <errno.h>
#include <string.h>

int main() {
    ai_audio_client_t client;
    int ret;

    log_info("=== éŸ³é¢‘å®¢æˆ·ç«¯å¯åŠ¨ ===\n");

    // åˆå§‹åŒ–å®¢æˆ·ç«¯
    ret = ai_audio_init(&client);
    if (ret != 0) {
        log_error("âŒ åˆå§‹åŒ–å¤±è´¥: é”™è¯¯ç  %d\n", ret);
        return -1;
    }
    log_info("âœ… å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ\n");

    // æ’­æ”¾éŸ³é¢‘
    log_info("å¼€å§‹æ’­æ”¾éŸ³é¢‘æ–‡ä»¶...\n");
    ret = ai_audio_play(&client, "/tmp/test.pcm", 80, 48000, 2, 16, 0);
    if (ret != 0) {
        log_error("âŒ æ’­æ”¾å¤±è´¥: %s\n", ai_audio_get_error_string(ret));
        ai_audio_cleanup(&client);
        return -1;
    }
    log_info("âœ… éŸ³é¢‘æ’­æ”¾æˆåŠŸ\n");

    // æ¸…ç†èµ„æº
    ai_audio_cleanup(&client);
    log_info("=== ç¨‹åºæ­£å¸¸é€€å‡º ===\n");

    return 0;
}
```

**è¾“å‡ºæ•ˆæœ**:
```
[2025-10-27 14:23:45.001] === éŸ³é¢‘å®¢æˆ·ç«¯å¯åŠ¨ ===
[2025-10-27 14:23:45.015] âœ… å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ
[2025-10-27 14:23:45.018] å¼€å§‹æ’­æ”¾éŸ³é¢‘æ–‡ä»¶...
[2025-10-27 14:23:46.123] âœ… éŸ³é¢‘æ’­æ”¾æˆåŠŸ
[2025-10-27 14:23:46.125] === ç¨‹åºæ­£å¸¸é€€å‡º ===
```

### 3.3 æ€§èƒ½è°ƒè¯•ç¤ºä¾‹

```c
#include "ai_log.h"
#include <sys/time.h>

long get_time_ms() {
    struct timeval tv;
    gettimeofday(&tv, NULL);
    return tv.tv_sec * 1000 + tv.tv_usec / 1000;
}

void process_data(const char *data, size_t len) {
    long start = get_time_ms();

    log_debug("å¼€å§‹å¤„ç†æ•°æ®: %zu å­—èŠ‚\n", len);

    // å¤„ç†æ•°æ®...

    long elapsed = get_time_ms() - start;
    if (elapsed > 100) {
        log_warn("âš ï¸  å¤„ç†è€—æ—¶è¿‡é•¿: %ld ms\n", elapsed);
    } else {
        log_debug("å¤„ç†å®Œæˆ: %ld ms\n", elapsed);
    }
}
```

### 3.4 é”™è¯¯å¤„ç†ç¤ºä¾‹

```c
#include "ai_log.h"
#include <errno.h>
#include <string.h>
#include <fcntl.h>

int open_config_file(const char *path) {
    log_debug("å°è¯•æ‰“å¼€é…ç½®æ–‡ä»¶: %s\n", path);

    int fd = open(path, O_RDONLY);
    if (fd < 0) {
        log_error("âŒ æ‰“å¼€é…ç½®æ–‡ä»¶å¤±è´¥: %s (é”™è¯¯: %s)\n",
                  path, strerror(errno));
        return -1;
    }

    log_info("âœ… é…ç½®æ–‡ä»¶æ‰“å¼€æˆåŠŸ: %s (fd=%d)\n", path, fd);
    return fd;
}
```

---

## å››ã€é›†æˆæ–¹æ³•

### 4.1 SDK åº“å·²åŒ…å«æ—¥å¿—ç³»ç»Ÿ

æ—¥å¿—ç³»ç»Ÿå·²ç»ç¼–è¯‘åˆ° AI Glass SDK åº“ä¸­ï¼Œæ— éœ€é¢å¤–ç¼–è¯‘ã€‚

**åº“æ–‡ä»¶**:
- é™æ€åº“: `ai_glass_sdk/lib/libai_glass_sdk.a`
- åŠ¨æ€åº“: `ai_glass_sdk/lib/libai_glass_sdk.so`

### 4.2 ç¼–è¯‘è‡ªå·±çš„ç¨‹åº

#### é“¾æ¥ SDK åº“

```bash
arm-rockchip831-linux-uclibcgnueabihf-gcc \
    -o my_app my_app.c \
    -I/path/to/ai_glass_sdk/include \
    -L/path/to/ai_glass_sdk/lib \
    -lai_glass_sdk \
    -lpthread -lrt
```

### 4.3 åœ¨é¡¹ç›®ä¸­ä½¿ç”¨

**æ­¥éª¤**:
1. åŒ…å«å¤´æ–‡ä»¶: `#include "ai_log.h"`
2. ä½¿ç”¨æ—¥å¿—å‡½æ•°: `log_info()`, `log_error()` ç­‰
3. ç¼–è¯‘æ—¶é“¾æ¥ SDK åº“

**æ³¨æ„**: æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½å¯ä»¥ä½¿ç”¨æ—¥å¿—ç³»ç»Ÿã€‚

---

## äº”ã€è¾“å‡ºæ ¼å¼

### 5.1 æ—¶é—´æˆ³æ ¼å¼

```
[YYYY-MM-DD HH:MM:SS.mmm] æ—¥å¿—å†…å®¹
```

**è¯´æ˜**:
- `YYYY-MM-DD` - å¹´æœˆæ—¥
- `HH:MM:SS` - æ—¶åˆ†ç§’ï¼ˆ24å°æ—¶åˆ¶ï¼‰
- `mmm` - æ¯«ç§’ï¼ˆ000-999ï¼‰

### 5.2 ç¤ºä¾‹è¾“å‡º

```
[2025-10-27 14:23:45.123] âœ… ç¨‹åºå¯åŠ¨æˆåŠŸ
[2025-10-27 14:23:45.456] è¿æ¥åˆ°æœåŠ¡å™¨: 192.168.1.100:8080
[2025-10-27 14:23:46.789] ğŸ“¡ æ”¶åˆ°å“åº”: 1024 å­—èŠ‚
[2025-10-27 14:23:47.012] âŒ è§£æå¤±è´¥: Invalid JSON
[2025-10-27 14:23:47.234] é‡è¯•ä¸­... (1/3)
```

### 5.3 æ—¶é—´ç²¾åº¦

- **ç²¾åº¦**: æ¯«ç§’çº§ï¼ˆ1msï¼‰
- **å®ç°**: ä½¿ç”¨ `clock_gettime(CLOCK_REALTIME)` è·å–çº³ç§’çº§æ—¶é—´
- **æ—¶åŒº**: æœ¬åœ°æ—¶åŒºï¼ˆä½¿ç”¨ `localtime_r` è½¬æ¢ï¼‰

---

## å…­ã€æ³¨æ„äº‹é¡¹

### 6.1 å­—ç¬¦ç¼–ç 

âœ… **å®Œå…¨å…¼å®¹åŸæœ‰ printf çš„ç¼–ç æ–¹å¼**
- æ”¯æŒä¸­æ–‡ã€è‹±æ–‡ã€emoji ç­‰æ‰€æœ‰å­—ç¬¦
- ä¸åšä»»ä½•ç¼–ç è½¬æ¢
- ä¸ä¼šé€ æˆä¹±ç é—®é¢˜

**åŸç†**: ä½¿ç”¨ `vprintf()` ç›´æ¥è¾“å‡ºï¼Œåªåœ¨å‰é¢æ·»åŠ æ—¶é—´æˆ³å­—ç¬¦ä¸²ã€‚

### 6.2 çº¿ç¨‹å®‰å…¨

âœ… **åŸºæœ¬çº¿ç¨‹å®‰å…¨**
- `printf()` æœ¬èº«æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ˆæœ‰å†…éƒ¨é”ï¼‰
- å¤šçº¿ç¨‹è°ƒç”¨æ—¥å¿—å‡½æ•°ä¸ä¼šå¯¼è‡´å´©æºƒ
- ä½†åŒä¸€æ—¶åˆ»å¤šä¸ªçº¿ç¨‹è¾“å‡ºå¯èƒ½äº¤é”™ï¼ˆè¿™æ˜¯ printf çš„æ­£å¸¸è¡Œä¸ºï¼‰

### 6.3 æ€§èƒ½å¼€é”€

**æ—¶é—´å¼€é”€**:
- æ¯æ¬¡æ—¥å¿—è°ƒç”¨å¢åŠ çº¦ **1-2 å¾®ç§’**ï¼ˆè·å–æ—¶é—´æˆ³ï¼‰
- å¯¹äºåµŒå…¥å¼ç³»ç»Ÿæ¥è¯´å¼€é”€å¾ˆå°

**å»ºè®®**:
- åœ¨æ€§èƒ½å…³é”®è·¯å¾„ä¸Šï¼Œå¯ä»¥å‡å°‘ `log_debug()` è°ƒç”¨
- æ­£å¸¸çš„ `log_info()` å’Œ `log_error()` å¼€é”€å¯å¿½ç•¥

### 6.4 è¾“å‡ºç›®æ ‡

å½“å‰æ‰€æœ‰æ—¥å¿—è¾“å‡ºåˆ° **æ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼‰**ã€‚

**æœªæ¥å¯æ‰©å±•**:
- è¾“å‡ºåˆ°æ–‡ä»¶
- è¾“å‡ºåˆ° syslog
- åŠ¨æ€æ§åˆ¶æ—¥å¿—çº§åˆ«
- æ·»åŠ æ—¥å¿—è¿‡æ»¤

### 6.5 ä¸ç°æœ‰ä»£ç é›†æˆ

**å¹³æ»‘æ›¿æ¢**:
1. å…ˆç¼–è¯‘æ—¥å¿—ç³»ç»Ÿï¼ˆå·²å®Œæˆï¼‰
2. åœ¨éœ€è¦çš„æ–‡ä»¶ä¸­ `#include "ai_log.h"`
3. é€æ­¥å°† `printf()` æ›¿æ¢ä¸º `log_info()` ç­‰
4. å¯ä»¥æ¸è¿›å¼æ›¿æ¢ï¼Œæ–°æ—§ä»£ç å¯ä»¥å…±å­˜

**æ›¿æ¢å»ºè®®**:
- âœ… æˆåŠŸã€å®Œæˆç±»ä¿¡æ¯ â†’ `log_info()`
- âŒ é”™è¯¯ã€å¤±è´¥ç±»ä¿¡æ¯ â†’ `log_error()`
- ğŸ“¡ è°ƒè¯•ã€æ€§èƒ½ç±»ä¿¡æ¯ â†’ `log_debug()`
- âš ï¸  è­¦å‘Šã€æç¤ºç±»ä¿¡æ¯ â†’ `log_warn()`

### 6.6 æ ¼å¼åŒ–å­—ç¬¦ä¸²

**å®Œå…¨å…¼å®¹ printf æ ¼å¼**:
```c
// å­—ç¬¦ä¸²
log_info("æ¶ˆæ¯: %s\n", str);

// æ•´æ•°
log_info("è®¡æ•°: %d, å¤§å°: %zu\n", count, size);

// åå…­è¿›åˆ¶
log_debug("åœ°å€: 0x%p, å€¼: 0x%08X\n", ptr, value);

// æµ®ç‚¹æ•°
log_info("è¿›åº¦: %.2f%%\n", progress);
```

---

## ä¸ƒã€å¸¸è§é—®é¢˜

### Q1: æ—¶é—´æˆ³ä¼šä¸ä¼šå½±å“æ€§èƒ½ï¼Ÿ

**ç­”**: å¼€é”€æå°ï¼ˆ1-2å¾®ç§’ï¼‰ï¼Œå¯¹åµŒå…¥å¼ç³»ç»Ÿå½±å“å¯å¿½ç•¥ã€‚

### Q2: æ”¯æŒä¸­æ–‡å’Œ emoji å—ï¼Ÿ

**ç­”**: å®Œå…¨æ”¯æŒã€‚æ—¥å¿—ç³»ç»Ÿä¸åšç¼–ç è½¬æ¢ï¼ŒåŸæ ·è¾“å‡ºã€‚

### Q3: å¯ä»¥å…³é—­æŸä¸ªçº§åˆ«çš„æ—¥å¿—å—ï¼Ÿ

**ç­”**: å½“å‰ç‰ˆæœ¬ä¸æ”¯æŒã€‚æœªæ¥ç‰ˆæœ¬å¯ä»¥è€ƒè™‘æ·»åŠ æ—¥å¿—çº§åˆ«æ§åˆ¶ã€‚

### Q4: æ—¥å¿—ä¼šä¿å­˜åˆ°æ–‡ä»¶å—ï¼Ÿ

**ç­”**: å½“å‰ç‰ˆæœ¬è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚å¯ä»¥é€šè¿‡é‡å®šå‘ä¿å­˜ï¼š
```bash
./my_app > app.log 2>&1
```

### Q5: å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ—¥å¿—ä¼šä¹±å—ï¼Ÿ

**ç­”**: `printf()` æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸ä¼šå´©æºƒã€‚ä½†å¤šçº¿ç¨‹åŒæ—¶è¾“å‡ºå¯èƒ½äº¤é”™ï¼Œè¿™æ˜¯æ­£å¸¸ç°è±¡ã€‚

---

## å…«ã€ç‰ˆæœ¬å†å²

### v1.0 (2025-10-27)
- âœ… åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… æ”¯æŒæ¯«ç§’çº§æ—¶é—´æˆ³
- âœ… æä¾› infoã€errorã€debugã€warn å››ç§æ—¥å¿—çº§åˆ«
- âœ… é›†æˆåˆ° AI Glass SDK åº“

---

## ä¹ã€ç›¸å…³é“¾æ¥

- **ä¸» SDK æ–‡æ¡£**: [AI Glass SDK README](../README.md)
- **API å¤´æ–‡ä»¶**: `ai_glass_sdk/include/ai_log.h`
- **å…¶ä»– API æ–‡æ¡£**:
  - [GPIO å®¢æˆ·ç«¯ API](GPIO_Client_API.md)
  - [æ‘„åƒå¤´å®¢æˆ·ç«¯ API](Camera_Client_API.md)
  - [éŸ³é¢‘å®¢æˆ·ç«¯ API](Audio_Client_API.md)
  - [TTS å®¢æˆ·ç«¯ API](TTS_Client_API.md)

---

*æœ€åæ›´æ–°ï¼š2025-10-27*
