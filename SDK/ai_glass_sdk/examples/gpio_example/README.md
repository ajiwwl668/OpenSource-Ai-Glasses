# GPIO Example ä½¿ç”¨è¯´æ˜

## ç®€ä»‹

`gpio_example` æ˜¯ä¸€ä¸ªæ¼”ç¤ºç¨‹åºï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ AI Glass SDK çš„ GPIO äº‹ä»¶å¹¿æ’­æœåŠ¡è®¢é˜…å’Œå¤„ç† GPIO æŒ‰é”®äº‹ä»¶ã€‚

### æ ¸å¿ƒç‰¹æ€§
- è®¢é˜… GPIO æŒ‰é”®äº‹ä»¶ï¼ˆæŒ‰ä¸‹/é‡Šæ”¾ï¼‰
- å¼‚æ­¥äº‹ä»¶å›è°ƒæœºåˆ¶ï¼Œå®æ—¶å“åº”
- å¤šè¿›ç¨‹å…±äº«åŒä¸€ GPIO äº‹ä»¶æº
- æ— éœ€ç›´æ¥è®¿é—® GPIO ç¡¬ä»¶
- å®Œæ•´çš„äº‹ä»¶ç»Ÿè®¡å’Œè°ƒè¯•ä¿¡æ¯

## å·¥ä½œåŸç†

### æ¶æ„è¯´æ˜
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ai-core æœåŠ¡   â”‚  (ç›‘æ§GPIOç¡¬ä»¶)
â”‚  GPIO Manager   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ å¹¿æ’­äº‹ä»¶
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”  â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚ å®¢æˆ·ç«¯1 â”‚  â”‚ å®¢æˆ·ç«¯2 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

1. **æœåŠ¡ç«¯** (ai-core)ï¼šç›‘æ§ GPIO ç¡¬ä»¶çŠ¶æ€å˜åŒ–
2. **äº‹ä»¶å¹¿æ’­**ï¼šé€šè¿‡ Unix Domain Socket å¹¿æ’­äº‹ä»¶ç»™æ‰€æœ‰è®¢é˜…å®¢æˆ·ç«¯
3. **å®¢æˆ·ç«¯**ï¼šæ¥æ”¶äº‹ä»¶å¹¶åœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­æ‰§è¡Œå›è°ƒå‡½æ•°

## ç¼–è¯‘

```bash
cd ai_glass_sdk/examples/gpio_example
make
```

ç¼–è¯‘äº§ç‰©ï¼š`gpio_example`

## å‰ç½®æ¡ä»¶

### 1. å¯åŠ¨ AI Core æœåŠ¡ï¼ˆå¯ç”¨ GPIO åŠŸèƒ½ï¼‰
```bash
# åœ¨æœåŠ¡ç«¯ç›®å½•
cd service
./build/ai-core --enable-gpio
```

### 2. ç¡®è®¤ GPIO é…ç½®
æœåŠ¡ç«¯éœ€è¦æ­£ç¡®é…ç½®è¦ç›‘æ§çš„ GPIO å¼•è„šï¼ˆé»˜è®¤ä¸º gpio-1ï¼Œå¯¹åº”å·¦é•œè…¿ç‰©ç†æŒ‰é”®ï¼‰ã€‚

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬è¿è¡Œ
```bash
./gpio_example
```

### ç¨‹åºè¾“å‡ºç¤ºä¾‹
```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  GPIOäº‹ä»¶å®¢æˆ·ç«¯ç¤ºä¾‹ç¨‹åº
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€åŠŸèƒ½ã€‘è®¢é˜…GPIOäº‹ä»¶ï¼Œå®æ—¶æ¥æ”¶æŒ‰é”®é€šçŸ¥

ã€ä½¿ç”¨æ–¹æ³•ã€‘
  ./gpio_example

ã€å‰ç½®æ¡ä»¶ã€‘
  1. ç¡®ä¿ai-coreæœåŠ¡ç«¯å·²å¯åŠ¨
  2. æœåŠ¡ç«¯éœ€è¦å¯ç”¨GPIOåŠŸèƒ½ï¼ˆ--enable-gpioï¼‰

ã€é€€å‡ºæ–¹å¼ã€‘
  æŒ‰ Ctrl+C é€€å‡ºç¨‹åº

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  GPIOäº‹ä»¶å®¢æˆ·ç«¯ - å¼‚æ­¥å›è°ƒæ¨¡å¼
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ [æ­¥éª¤1/3] åˆ›å»ºGPIOäº‹ä»¶å®¢æˆ·ç«¯...
âœ… å®¢æˆ·ç«¯å·²åˆ›å»º

ğŸ“ [æ­¥éª¤2/3] è¿æ¥åˆ°GPIOäº‹ä»¶å¹¿æ’­æœåŠ¡...
âœ… å·²è¿æ¥åˆ°æœåŠ¡

ğŸ“ [æ­¥éª¤3/3] è®¢é˜…GPIOäº‹ä»¶...
âœ… å·²è®¢é˜…GPIOäº‹ä»¶
   - æœ¬åœ°é€šçŸ¥Socket: /tmp/gpio_notify_12345
   - å½“å‰äº‹ä»¶åºåˆ—å·: 0

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ§ ç›‘å¬ä¸­... è¯·æŒ‰ä¸‹GPIOæŒ‰é”®
  ğŸ’¡ æç¤ºï¼šæŒ‰ Ctrl+C é€€å‡ºç¨‹åº
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### æŒ‰é”®äº‹ä»¶è¾“å‡ºç¤ºä¾‹

#### æŒ‰ä¸‹äº‹ä»¶
```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ”´ GPIO1 æŒ‰é”®æŒ‰ä¸‹äº‹ä»¶
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  æ—¶é—´æˆ³: 1234567890123 us
  æŒ‰ä¸‹æ¬¡æ•°: 1
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

#### é‡Šæ”¾äº‹ä»¶
```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  âšª GPIO1 æŒ‰é”®é‡Šæ”¾äº‹ä»¶
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  æ—¶é—´æˆ³: 1234567891234 us
  é‡Šæ”¾æ¬¡æ•°: 1
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### é€€å‡ºç¨‹åº
æŒ‰ `Ctrl+C` é€€å‡ºï¼Œç¨‹åºä¼šè‡ªåŠ¨æ¸…ç†èµ„æºï¼š
```
ğŸ›‘ æ”¶åˆ°é€€å‡ºä¿¡å·ï¼Œå‡†å¤‡å…³é—­...

ğŸ“ æ¸…ç†èµ„æº...
   - å·²æ³¨é”€é€šçŸ¥Socket
âœ… èµ„æºå·²æ¸…ç†

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ç¨‹åºé€€å‡º
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  æ€»æŒ‰ä¸‹æ¬¡æ•°: 5
  æ€»é‡Šæ”¾æ¬¡æ•°: 5
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## ç¨‹åºåŠŸèƒ½è¯´æ˜

### äº‹ä»¶ç±»å‹
- **GPIO_EVENT_PRESS** - æŒ‰é”®æŒ‰ä¸‹
- **GPIO_EVENT_RELEASE** - æŒ‰é”®é‡Šæ”¾
- **GPIO_EVENT_ERROR** - é”™è¯¯äº‹ä»¶

### å›è°ƒå‡½æ•°
ç¨‹åºé€šè¿‡ `my_gpio_event_callback()` å‡½æ•°å¤„ç†äº‹ä»¶ï¼š
```c
void my_gpio_event_callback(gpio_event_t event_type,
                           int gpio_number,
                           void *user_data) {
    // å¤„ç†äº‹ä»¶
}
```

### ç‰¹æ€§
1. **å®æ—¶å“åº”**ï¼šå›è°ƒåœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹
2. **äº‹ä»¶ç»Ÿè®¡**ï¼šè‡ªåŠ¨ç»Ÿè®¡æŒ‰ä¸‹å’Œé‡Šæ”¾æ¬¡æ•°
3. **å¿ƒè·³æ£€æŸ¥**ï¼šæ¯ 10 ç§’æ£€æŸ¥ä¸€æ¬¡æœåŠ¡çŠ¶æ€
4. **ä¼˜é›…é€€å‡º**ï¼šCtrl+C è§¦å‘èµ„æºæ¸…ç†

## ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šæŒ‰é”®è§¦å‘å½•éŸ³
```c
void my_gpio_event_callback(gpio_event_t event_type, int gpio_number, void *user_data) {
    if (event_type == GPIO_EVENT_PRESS) {
        // å¼€å§‹å½•éŸ³
        start_recording();
    } else if (event_type == GPIO_EVENT_RELEASE) {
        // åœæ­¢å½•éŸ³
        stop_recording();
    }
}
```

### åœºæ™¯2ï¼šæŒ‰é”®è®¡æ•°å™¨
```c
static int button_press_count = 0;

void my_gpio_event_callback(gpio_event_t event_type, int gpio_number, void *user_data) {
    if (event_type == GPIO_EVENT_PRESS) {
        button_press_count++;
        printf("æŒ‰é”®æ¬¡æ•°: %d\n", button_press_count);
    }
}
```

### åœºæ™¯3ï¼šé•¿æŒ‰æ£€æµ‹
```c
static uint64_t press_timestamp = 0;

void my_gpio_event_callback(gpio_event_t event_type, int gpio_number, void *user_data) {
    if (event_type == GPIO_EVENT_PRESS) {
        press_timestamp = ai_gpio_get_timestamp_us();
    } else if (event_type == GPIO_EVENT_RELEASE) {
        uint64_t duration = ai_gpio_get_timestamp_us() - press_timestamp;
        if (duration > 2000000) {  // 2ç§’
            printf("æ£€æµ‹åˆ°é•¿æŒ‰ï¼\n");
        }
    }
}
```

## é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

#### 1. è¿æ¥å¤±è´¥
```
âŒ è¿æ¥å¤±è´¥ï¼Œè¯·ç¡®ä¿ai-coreå·²å¯åŠ¨å¹¶å¯ç”¨GPIOåŠŸèƒ½
```
**è§£å†³**ï¼š
- æ£€æŸ¥ `ai-core` æœåŠ¡æ˜¯å¦è¿è¡Œ
- ç¡®è®¤å¯åŠ¨æ—¶ä½¿ç”¨äº† `--enable-gpio` å‚æ•°

#### 2. è®¢é˜…å¤±è´¥
```
âŒ è®¢é˜…å¤±è´¥
```
**è§£å†³**ï¼š
- æ£€æŸ¥ GPIO ç®¡ç†å™¨æ˜¯å¦æ­£ç¡®åˆå§‹åŒ–
- æŸ¥çœ‹æœåŠ¡ç«¯æ—¥å¿—äº†è§£è¯¦ç»†é”™è¯¯ä¿¡æ¯

#### 3. æœåŠ¡åœæ­¢
```
âš ï¸  æœåŠ¡å·²åœæ­¢ï¼Œå‡†å¤‡é€€å‡º
```
**è§£å†³**ï¼š
- æœåŠ¡ç«¯æ„å¤–é€€å‡ºï¼Œé‡å¯ `ai-core` æœåŠ¡

## è¿”å›å€¼

| è¿”å›å€¼ | è¯´æ˜ |
|--------|------|
| `0` | æ­£å¸¸é€€å‡º |
| `-1` | åˆå§‹åŒ–å¤±è´¥æˆ–è¿æ¥å¤±è´¥ |

## ç¼–ç¨‹æ¥å£

### æ ¸å¿ƒ API å‡½æ•°

```c
// 1. åˆ›å»ºå®¢æˆ·ç«¯
int ai_gpio_event_client_create(gpio_event_client_t *client);

// 2. è¿æ¥åˆ°æœåŠ¡
int ai_gpio_event_client_connect(gpio_event_client_t *client);

// 3. è®¢é˜…äº‹ä»¶ï¼ˆæ³¨å†Œå›è°ƒå‡½æ•°ï¼‰
int ai_gpio_event_client_subscribe(gpio_event_client_t *client,
                                   gpio_event_callback_t callback,
                                   void *user_data);

// 4. æ£€æŸ¥æœåŠ¡çŠ¶æ€
int ai_gpio_event_client_is_service_alive(gpio_event_client_t *client);

// 5. å–æ¶ˆè®¢é˜…
void ai_gpio_event_client_unsubscribe(gpio_event_client_t *client);

// 6. æ–­å¼€è¿æ¥
void ai_gpio_event_client_disconnect(gpio_event_client_t *client);

// 7. é”€æ¯å®¢æˆ·ç«¯
void ai_gpio_event_client_destroy(gpio_event_client_t *client);

// è¾…åŠ©å‡½æ•°
uint64_t ai_gpio_get_timestamp_us(void);  // è·å–å¾®ç§’çº§æ—¶é—´æˆ³
```

### å®Œæ•´ API æ–‡æ¡£
è¯¦ç»†çš„ç¼–ç¨‹æ¥å£æ–‡æ¡£ï¼Œè¯·å‚è§ï¼š
**ğŸ“š [GPIO Client API å¼€å‘æŒ‡å—](../../docs/GPIO_Client_API.md)**

## å¤šå®¢æˆ·ç«¯æ”¯æŒ

å¤šä¸ªå®¢æˆ·ç«¯å¯ä»¥åŒæ—¶è®¢é˜…åŒä¸€ä¸ª GPIO äº‹ä»¶ï¼š

```bash
# ç»ˆç«¯1
./gpio_example

# ç»ˆç«¯2
./gpio_example

# ä¸¤ä¸ªå®¢æˆ·ç«¯éƒ½ä¼šæ”¶åˆ°åŒæ ·çš„æŒ‰é”®äº‹ä»¶
```

## æ€§èƒ½ç‰¹ç‚¹

- **ä½å»¶è¿Ÿ**ï¼šäº‹ä»¶å¹¿æ’­å»¶è¿Ÿé€šå¸¸ < 1ms
- **é«˜å¹¶å‘**ï¼šæ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è®¢é˜…
- **è½»é‡çº§**ï¼šå•ä¸ªå®¢æˆ·ç«¯ä»…å ç”¨å°‘é‡å†…å­˜ï¼ˆ< 100KBï¼‰

## è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹æœåŠ¡ç«¯æ—¥å¿—
```bash
# æœåŠ¡ç«¯ä¼šè¾“å‡ºGPIOçŠ¶æ€å˜åŒ–
# æŸ¥çœ‹æ˜¯å¦æœ‰äº‹ä»¶å¹¿æ’­æ—¥å¿—
```

### 2. æ£€æŸ¥ Socket è¿æ¥
```bash
# æŸ¥çœ‹å®¢æˆ·ç«¯ Socket
ls -la /tmp/gpio_notify_*

# æŸ¥çœ‹æœåŠ¡ç«¯ Socket
ls -la /tmp/ai-core_gpio_*
```

### 3. å¯ç”¨è¯¦ç»†æ—¥å¿—
ä¿®æ”¹æºä»£ç ä¸­çš„æ—¥å¿—çº§åˆ«ï¼Œå¯ä»¥çœ‹åˆ°æ›´å¤šè°ƒè¯•ä¿¡æ¯ã€‚

## æ³¨æ„äº‹é¡¹

1. æ­¤ç¨‹åºéœ€è¦åœ¨ç›®æ ‡ ARM è®¾å¤‡ä¸Šè¿è¡Œï¼Œæ— æ³•åœ¨ x86 ä¸»æœºä¸Šç›´æ¥æ‰§è¡Œ
2. å¿…é¡»å…ˆå¯åŠ¨ `ai-core` æœåŠ¡ä¸”å¯ç”¨ GPIO åŠŸèƒ½
3. å›è°ƒå‡½æ•°åœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œæ³¨æ„çº¿ç¨‹å®‰å…¨
4. ç¡®ä¿æœ‰è¶³å¤Ÿçš„æƒé™è®¿é—® `/tmp` ç›®å½•

## ç›¸å…³å‘½ä»¤

- æŸ¥çœ‹å¸®åŠ©: è¿è¡Œç¨‹åºä¼šè‡ªåŠ¨æ˜¾ç¤ºä½¿ç”¨è¯´æ˜
- æ£€æŸ¥æœåŠ¡: `ps aux | grep ai-core`
- æŸ¥çœ‹ Socket: `ls -la /tmp/gpio_*`

## ç›¸å…³æ–‡æ¡£

- **ç¼–ç¨‹æ¥å£**: [GPIO Client API å¼€å‘æŒ‡å—](../../docs/GPIO_Client_API.md)
- **GPIO æ¶æ„**: [GPIO Architecture](../../../docs/server/GPIO_ARCHITECTURE.md)
- **SDK æ–‡æ¡£**: `../../README.md`
- **å¤´æ–‡ä»¶**: `../../include/ai_gpio.h`
